#!/usr/bin/env node

/*
Usage: sassdoc <src> <dest> [options]

Arguments:
  <src>   Path to your Sass folder.
  <dest>  Path to the destination folder.

Options:
  -h, --help            Bring help.
  --version             Show version.
  -v, --verbose         Run in verbose mode.
  -c, --config=<path>   Path to JSON file containing variable to be passed
                        to the view.
*/

var fs = require('fs');
var api = require('../src/api');
var logger = require('../src/log');
var docopt = require('docopt').docopt;

var project;
var config;

var doc = fs.readFileSync(__filename, 'utf-8');
doc = doc.substr(doc.indexOf('/*') + 2);
doc = doc.substr(0, doc.indexOf('*/'));

// Define version
var pkg = JSON.parse(fs.readFileSync(__dirname + '/../package.json', 'utf-8'));
var options = docopt(doc, {
  version: pkg.version
});

// Enable verbose mode
if (options['--verbose'] === true) {
  logger.enabled = true;
}

// Find configuration file
if (!options['--config']) {
  options['--config'] = 'view/view.json';
}

try {
  config = require(process.cwd() + '/' + options['--config']);
}

catch(e) {
  console.log(e);
  throw e;
}

// Find package file

if (typeof config.package === "string") {
  var pkg_path = process.cwd() + '/' + config.package;
  try {
    package = require(pkg_path);
  }

  catch(e) {
    logger.log('Can\'t find a package file at `' + pkg_path + '`.');
  }

  if (package) {
    config.package = package;
  }
}

// Initialize
if (typeof options['<src>'] !== 'undefined' || typeof options['<dest>'] !== 'undefined') {
  api.documentize(options['<src>'], options['<dest>'], config);
}
